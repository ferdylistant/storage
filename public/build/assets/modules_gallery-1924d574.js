async function t(t,e){const n=document.getElementById("moments");if(!n)return;const a=window.location.pathname.split("/").filter(Boolean),i=a.length>1&&"moments"===a[0]?a[1]:null;let l=[],r=null;const o=function(t,e){return debounce(()=>{"function"==typeof t&&t(),"function"==typeof e&&e()},150)}(t,e),s=()=>{requestAnimationFrame(()=>setTimeout(o,80))};async function c(){try{const t=await fetch("/tab/moments",{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error("Failed to load albums");const e=await t.json();n.innerHTML=e.html,document.querySelectorAll(".album-item").forEach(t=>{t.addEventListener("click",async()=>{const e=t.getAttribute("data-album-slug");history.pushState(null,"",`/moments/${e}`),await d(e)})}),s(),r=null,l=[]}catch(t){n.innerHTML='<div class="alert alert-danger text-center">Failed to load albums.</div>'}}async function d(t){try{const e=await fetch(`/tab/moments/${t}`,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!e.ok)throw new Error("Failed to load album photos");const a=await e.json(),i=(a.items??[]).filter(t=>t&&t.src&&t.srct).map(t=>({src:t.src,srct:/Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent)?t.srct:t.src,tags:t.tags??""}));if(n.innerHTML=`\n            <div class="d-flex justify-content-between align-items-center mb-3">\n                <button id="backToAlbums" class="btn btn-glass btn-sm">← Back</button>\n                <h2 style="font-family: Nickson, sans-serif;" class="text-decoration-underline mb-0">${a.album_name??"Untitled Album"}</h2>\n            </div>\n            <p class="text-center text-md-start mb-3">Click on an image to view it in a gallery.</p>\n            <div id="nanogalleryMoment"></div>\n        `,0===i.length)return void(document.getElementById("nanogalleryMoment").innerHTML=`\n    <div class="text-center py-5 px-3 glass-timeline">\n        <div class="mb-3">\n            <svg xmlns="http://www.w3.org/2000/svg" width="72" height="72" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>\n                <path d="M3 17l5-5 4 4 5-6 4 7"/>\n            </svg>\n        </div>\n        <h3 class="text-warning mb-1" style="font-family: Nickson, sans-serif; letter-spacing: 0.3rem">No photos in this album yet</h3>\n        <p class="text-white text-center mb-0">Check back later — maybe new moments ${a.album_name} will be added.</p>\n    </div>\n`);await async function(t){if(document.querySelector(`link[href*="${t.split("/").pop()}"]`))return;const e=document.createElement("link");e.rel="stylesheet",e.href=t,document.head.appendChild(e)}("https://cdn.jsdelivr.net/npm/nanogallery2/dist/css/nanogallery2.min.css"),await m("https://code.jquery.com/jquery-3.7.1.min.js","jQuery"),await m("https://cdn.jsdelivr.net/npm/nanogallery2/dist/jquery.nanogallery2.min.js","jQuery.fn.nanogallery2"),jQuery("#nanogalleryMoment").nanogallery2({items:i,galleryMosaic:[{w:2,h:2,c:1,r:1},{w:1,h:1,c:3,r:1},{w:1,h:1,c:3,r:2},{w:1,h:2,c:4,r:1},{w:2,h:1,c:5,r:1},{w:2,h:2,c:5,r:2},{w:1,h:1,c:4,r:3},{w:2,h:1,c:2,r:3},{w:1,h:2,c:1,r:3},{w:1,h:1,c:2,r:4},{w:2,h:1,c:3,r:4},{w:1,h:1,c:5,r:4},{w:1,h:1,c:6,r:4}],galleryMosaicXS:[{w:2,h:2,c:1,r:1},{w:1,h:1,c:3,r:1},{w:1,h:1,c:3,r:2},{w:1,h:2,c:1,r:3},{w:2,h:1,c:2,r:3},{w:1,h:1,c:2,r:4},{w:1,h:1,c:3,r:4}],galleryMosaicSM:[{w:2,h:2,c:1,r:1},{w:1,h:1,c:3,r:1},{w:1,h:1,c:3,r:2},{w:1,h:2,c:1,r:3},{w:2,h:1,c:2,r:3},{w:1,h:1,c:2,r:4},{w:1,h:1,c:3,r:4}],galleryMaxRows:2,gallerySorting:"random",thumbnailDisplayOrder:"random",galleryMaxItemsPerPage:20,galleryPaginationMode:"scroll",thumbnailHeight:"200",thumbnailWidth:"auto",thumbnailAlignment:"scaled",thumbnailGutterWidth:3,thumbnailGutterHeight:3,thumbnailBorderHorizontal:0,thumbnailBorderVertical:0,galleryDisplayMode:"fullContent",galleryDisplayTransitionDuration:800,thumbnailDisplayTransition:"imageSlideUp",thumbnailDisplayTransitionDuration:400,thumbnailDisplayTransitionEasing:"easeInOutQuint",thumbnailDisplayInterval:20,thumbnailBuildInit2:"image_scale_1.15",thumbnailHoverEffect2:"thumbnail_scale_1.00_1.05_300|image_scale_1.15_1.00",touchAnimation:!0,touchAutoOpenDelay:500,thumbnailLabel:{display:!0,position:"onBottomOverImage",hideIcons:!0},viewerToolbar:{display:!1},viewerTools:{topLeft:"label",topRight:"shareButton, rotateLeft, rotateRight, fullscreenButton, closeButton"},locationHash:!1}),$("#nanogalleryMoment").on("galleryDisplayed.nanogallery2",function(){s()})}catch(e){n.innerHTML='\n            <div class="d-flex justify-content-between align-items-center mb-3">\n                <button id="backToAlbums" class="btn btn-glass btn-sm">← Back</button>\n            </div>\n            <div class="alert alert-danger text-center mt-4">\n                Failed to load photos. Please try again later.\n            </div>'}}async function m(t,e){return new Promise((n,a)=>{if(e.split(".").reduce((t,e)=>t?t[e]:void 0,window))return n();const i=document.createElement("script");i.src=t,i.async=!0,i.onload=()=>{e.split(".").reduce((t,e)=>t?t[e]:void 0,window)?n():a(new Error(`Script loaded but ${e} not found`))},i.onerror=()=>a(new Error(`Failed to load script: ${t}`)),document.head.appendChild(i)})}n.addEventListener("click",async t=>{("backToAlbums"===t.target.id||t.target.closest("#backToAlbums"))&&(history.pushState(null,"","/moments"),await c())}),i?await d(i):await c();const h=async()=>{const t=window.location.pathname.split("/").filter(Boolean),e=t.length>1&&"moments"===t[0]?t[1]:null;e?await d(e):await c()};window.removeEventListener("popstate",h),window.addEventListener("popstate",h);const u=debounce(()=>{l.length&&r&&function(t,e,n={}){const a=document.getElementById(t);if(!a)return;const i=a.clientWidth,l=n.spacing??8,o=n.rowHeight??200;let c=[],d=0;const m=[];function h(){if(!c.length)return;const t=c.reduce((t,e)=>t+e.aspectRatio,0),e=(i-l*(c.length-1))/t,n=c.map((t,n)=>{const a=e*t.aspectRatio,i=e,o=n===c.length-1?0:l;return`\n                        <a href="${t.src}" class="gallery-item glightbox" data-gallery="album-${r}" data-title="${t.title??"Untitled"}"\n                           style="flex: 0 0 ${a}px; height: ${i}px; margin-right: ${o}px;">\n                            <img src="${t.srct}" alt="${t.title??""}"/>\n                        </a>`}).join("");m.push(`<div class="gallery-row">${n}</div>`),c=[],d=0}for(const r of e){const t=o*r.aspectRatio;d+t+l*c.length>i&&h(),c.push(r),d+=t}h(),requestAnimationFrame(()=>{a.innerHTML=m.join(""),a.querySelectorAll(".gallery-item").forEach((t,e)=>{setTimeout(()=>t.classList.add("show"),50*e)}),s()})}("my_glightbox_gallery",l)},200);window.removeEventListener("resize",u),window.addEventListener("resize",u)}export{t as initGallery};
