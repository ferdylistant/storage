async function e(e){return new Promise((t,n)=>{if(document.querySelector(`script[src="${e}"]`))return void t();const l=document.createElement("script");l.src=e,l.async=!0,l.onload=()=>t(),l.onerror=()=>n(new Error(`Failed to load script: ${e}`)),document.head.appendChild(l)})}function t(){const e=$(".menu-icon"),t=$("#menuOverlay"),n=$("#menuIcon"),l=$("#mainNavbar");function i(e){t.hasClass("active"),t.toggleClass("active"),n.toggleClass("active"),l.toggleClass("hover-disabled");t.hasClass("active")?setTimeout(()=>{"function"==typeof e&&e(!0)},100):(history.replaceState(null,null,window.location.pathname+window.location.search),"function"==typeof e&&e(!1))}return e.on("click",()=>{i(e=>{if(e){const e=new URL(window.location);if(!e.searchParams.has("tab")){const n=t.find('a[data-bs-toggle="pill"]').first();if(n.length){$(".tab-pane").removeClass("show active"),$(".nav-link").removeClass("active").attr("aria-selected","false"),new bootstrap.Tab(n[0]).show();const t=n.attr("href");t.startsWith("#")&&(e.searchParams.set("tab",t.substring(1)),history.replaceState(null,null,e))}}}})}),$(".close-icon").on("click",function(){const e=new URL(window.location);e.searchParams.delete("tab"),history.replaceState(null,null,e.pathname+e.search+e.hash),t.removeClass("active"),n.removeClass("active"),l.removeClass("hover-disabled")}),{toggleOverlay:i}}function n(){const e=document.getElementById("albumsAccordion"),t=document.querySelector(".tab-content");if(!e||!t)return;const n=$(t);function l(){t.scrollHeight>t.clientHeight?n.getNiceScroll().length?n.getNiceScroll().resize():n.niceScroll({autohidemode:!0,cursorcolor:"#888",cursorwidth:"5px",zindex:9999,horizrailenabled:!1}):n.getNiceScroll().length&&(n.getNiceScroll().remove(),n.css("overflow",""))}let i;e.addEventListener("shown.bs.collapse",()=>{l()}),window.addEventListener("resize",()=>{clearTimeout(i),i=setTimeout(()=>{l()},200)}),l(),document.querySelectorAll(".play-icon").forEach(e=>{e.addEventListener("click",function(){const e=this.dataset.trackId,t=document.getElementById(`embed-${e}`);t.classList.contains("d-none")?t.classList.remove("d-none"):t.classList.add("d-none")})})}async function l(){const t=document.querySelector(".tab-content"),n=$(t);let l=null;function i(){t.scrollHeight>t.clientHeight?n.getNiceScroll().length?n.getNiceScroll().resize():n.niceScroll({autohidemode:!0,cursorcolor:"#888",cursorwidth:"5px",zindex:9999,horizrailenabled:!1}):n.getNiceScroll().length&&(n.getNiceScroll().remove(),n.css("overflow",""))}if(!window.GLightbox&&(await e("https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"),!document.querySelector('link[href*="glightbox.min.css"]'))){const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css",document.head.appendChild(e)}const a=document.getElementById("my_glightbox_gallery"),o=document.querySelector(".gallery-caption");try{let e=function(){"albums"!==l&&(l="albums",o.innerHTML='<p class="mb-3">Select an album to view its gallery.</p>',a.className="album-grid",a.innerHTML=c.map(e=>{const t=d.find(t=>t.albumID===e.albumID),n=(null==t?void 0:t.srct)||"https://via.placeholder.com/220x180?text=Album";return`\n            <div class="album-item" data-album-id="${e.albumID}">\n              <img src="${n}" alt="${e.title}" />\n              <div class="overlay-title">\n                <div class="album-title">${e.title}</div>\n              </div>\n            </div>\n          `}).join(""),i(),document.querySelectorAll(".album-item").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-album-id");n(t)})}))},t=function(t,n="Photos"){o.innerHTML=`\n        <div class="d-flex justify-content-start align-items-center mb-3">\n          <button class="btn btn-outline-secondary btn-sm" id="backToAlbums">← Back</button>\n          <h5 class="m-0 ms-2">${n}</h5>\n        </div>\n      `,a.className="gallery-grid mobile",a.innerHTML=t.map(e=>`\n        <a href="${e.src}" class="gallery-item glightbox" data-gallery="simple-album" data-title="${e.title||""}">\n          <img src="${e.srct}" alt="${e.title||""}" loading="lazy" />\n        </a>\n      `).join(""),GLightbox({selector:'.glightbox[data-gallery="simple-album"]'}),document.getElementById("backToAlbums").addEventListener("click",()=>{e()}),i()},n=function(n){if(l===`album-${n}`)return;l=`album-${n}`;const r=c.find(e=>String(e.albumID)===String(n)),s=d.filter(e=>String(e.albumID)===String(n));if(window.innerWidth<768)return t(s,null==r?void 0:r.title),void i();o.innerHTML=`\n        <div class="d-flex justify-content-start align-items-center mb-3">\n          <button class="btn btn-outline-secondary btn-sm" id="backToAlbums">← Back</button>\n          <h5 class="m-0 ms-2">${(null==r?void 0:r.title)||"Photos"}</h5>\n        </div>\n        <div class="text-center w-100">\n          <div class="spinner-border text-secondary my-3" role="status"></div>\n        </div>\n      `,a.innerHTML="",a.className="gallery-grid";const m=a.clientWidth||window.innerWidth-40;let u=[],g=0;function h(){if(!u.length)return;const e=u.reduce((e,t)=>e+t.aspectRatio,0),t=(m-4*(u.length-1))/e,l=u.map(e=>{const l=t*e.aspectRatio,i=t;return`\n            <a href="${e.src}" class="gallery-item glightbox" data-gallery="album-${n}" data-title="${e.title||""}" style="flex: 0 0 ${l}px; height: ${i}px">\n              <img src="${e.srct}" alt="${e.title||""}" loading="lazy" />\n            </a>\n          `}).join(""),i=document.createElement("div");i.className="gallery-row",i.innerHTML=l,a.appendChild(i),u=[],g=0}!async function(){for(const e of s)try{const t=await new Promise((t,n)=>{const l=new Image;l.onload=()=>t(l.width/l.height),l.onerror=n,l.src=e.srct});e.aspectRatio=t;const n=200*e.aspectRatio;u.push(e),g+=n+4,g>=m&&h(),await new Promise(e=>requestAnimationFrame(e))}catch(l){console.warn("Failed to load image",e.srct)}h(),GLightbox({selector:`.glightbox[data-gallery="album-${n}"]`});const t=o.querySelector(".spinner-border");t&&t.parentElement.remove(),document.getElementById("backToAlbums").addEventListener("click",()=>{e()}),i()}(),i()};const r=await fetch(window.location.origin+"/api/galleries");if(!r.ok)throw new Error("Failed fetching galleries");const s=await r.json(),c=s.filter(e=>"album"===e.kind),d=s.filter(e=>"image"===e.kind);if(0===c.length)return void(o.innerHTML='<div class="text-center p-5">\n          <h3>Stay Tuned</h3>\n          <p>Captured fuzzed-out moments will appear here soon.</p>\n      </div>');e()}catch(r){console.error("Failed to load gallery:",r),o.innerHTML='<div class="alert alert-danger text-center">Failed to load gallery.</div>'}}async function i(){window.jQuery&&window.jQuery.fn.nanogallery2||await e("https://cdn.jsdelivr.net/npm/nanogallery2@3.0.5/dist/jquery.nanogallery2.min.js");const t=$("#youtube_gallery"),n=$("#captionYoutube");t.data("nanogallery2")&&(t.nanogallery2("destroy"),t.empty());const l=[{src:"https://www.youtube.com/watch?v=RrduNLMk360&list=RDRrduNLMk360&start_radio=1",title:"Marsmolys - The Progeny of Holy Moly | Live Session"},{src:"https://www.youtube.com/watch?v=AvxFlL_8asI",title:"Marsmolys - Undestructible (Live at Artjog 2024)"},{src:"https://www.youtube.com/watch?v=UZPy_TrOp9Q&list=RDUZPy_TrOp9Q&start_radio=1",title:"Marsmolys - Ways To Go (Live at ArtJog 2024)"}];0!==l.length?(n.html('<p class="text-center text-md-start">Watch Marsmolys music videos and live performances.</p>'),t.nanogallery2({items:l,galleryDisplayMode:"fullContent",gallerySorting:"random",thumbnailHeight:180,thumbnailWidth:320,thumbnailGutterWidth:10,thumbnailGutterHeight:10,thumbnailAlignment:"fillWidth",thumbnailBorderHorizontal:0,thumbnailBorderVertical:0,thumbnailLabel:{display:!1,position:"overImageOnBottom",titleFontSize:"1em",align:"center",titleMultiLine:!0,displayDescription:!1},viewerToolbar:{display:!1},viewerTools:{topRight:"closeButton"},locationHash:!1}),t.on("galleryDisplayed.nanogallery2",function(){const e=$(".tab-content");e.getNiceScroll().length?e.getNiceScroll().resize():e.niceScroll({autohidemode:!0,cursorcolor:"#888",cursorwidth:"5px",zindex:9999,horizrailenabled:!1})})):n.html('\n      <div class="d-flex justify-content-center align-items-center flex-column p-5 text-center">\n        <h3 style="font-family: Nickson, \'sans-serif\'; letter-spacing: 2px;">Stay Tuned</h3>\n        <p>Marsmolys will be releasing music videos and live performances soon.</p>\n      </div>\n    ')}export{l as initGallery,t as initMenuToggle,n as initSoundtrackAlbum,i as initYouTubePlayers};
