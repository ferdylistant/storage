import{a as e,i as t,b as n,m as r}from"./axios-DpwkIHQ7.js";import{m as o,d as i,s,g as a,i as c,o as l}from"./lodash-es-BEYq8Rdu.js";let u=e.create(),d=(e,t)=>`${e.method}:${e.baseURL??t.defaults.baseURL??""}${e.url}`,g=e=>204===e.status&&"true"===e.headers["precognition-success"];const f={},h={get:(e,t={},n={})=>y(p("get",e,t,n)),post:(e,t={},n={})=>y(p("post",e,t,n)),patch:(e,t={},n={})=>y(p("patch",e,t,n)),put:(e,t={},n={})=>y(p("put",e,t,n)),delete:(e,t={},n={})=>y(p("delete",e,t,n)),use:e=>(u=e,h),axios:()=>u,fingerprintRequestsUsing:e=>(d=null===e?()=>null:e,h),determineSuccessUsing:e=>(g=e,h)},p=(e,t,n,r)=>({url:t,method:e,...r,...["get","delete"].includes(e)?{params:o({},n,r?.params)}:{data:o({},n,r?.data)}}),y=(e={})=>{const t=[m,E,b].reduce((e,t)=>t(e),e);return!1===(t.onBefore??(()=>!0))()?Promise.resolve(null):((t.onStart??(()=>null))(),u.request(t).then(async e=>{t.precognitive&&j(e);const n=e.status;let r=e;t.precognitive&&t.onPrecognitionSuccess&&g(r)&&(r=await Promise.resolve(t.onPrecognitionSuccess(r)??r)),t.onSuccess&&v(n)&&(r=await Promise.resolve(t.onSuccess(r)??r));return(S(t,n)??(e=>e))(r)??r},e=>{if(P(e))return Promise.reject(e);t.precognitive&&j(e.response);return(S(t,e.response.status)??((e,t)=>Promise.reject(t)))(e.response,e)}).finally(t.onFinish??(()=>null)))},m=e=>{const t=e.only??e.validate;return{...e,timeout:e.timeout??u.defaults.timeout??3e4,precognitive:!1!==e.precognitive,fingerprint:void 0===e.fingerprint?d(e,u):e.fingerprint,headers:{...e.headers,"Content-Type":C(e),...!1!==e.precognitive?{Precognition:!0}:{},...t?{"Precognition-Validate-Only":Array.from(t).join()}:{}}}},v=e=>e>=200&&e<300,E=e=>("string"!=typeof e.fingerprint||(f[e.fingerprint]?.abort(),delete f[e.fingerprint]),e),b=e=>"string"!=typeof e.fingerprint||e.signal||e.cancelToken||!e.precognitive?e:(f[e.fingerprint]=new AbortController,{...e,signal:f[e.fingerprint].signal}),j=e=>{if("true"!==e.headers?.precognition)throw Error("Did not receive a Precognition response. Ensure you have the Precognition middleware in place for the route.")},P=e=>!n(e)||"number"!=typeof e.response?.status||t(e),S=(e,t)=>({401:e.onUnauthorized,403:e.onForbidden,404:e.onNotFound,409:e.onConflict,422:e.onValidationError,423:e.onLocked}[t]),C=e=>e.headers?.["Content-Type"]??e.headers?.["Content-type"]??e.headers?.["content-type"]??(F(e.data)?"multipart/form-data":"application/json"),F=e=>A(e)||"object"==typeof e&&null!==e&&Object.values(e).some(e=>F(e)),A=e=>"undefined"!=typeof File&&e instanceof File||e instanceof Blob||"undefined"!=typeof FileList&&e instanceof FileList&&e.length>0,w=(e,u={})=>{const d={errorsChanged:[],touchedChanged:[],validatingChanged:[],validatedChanged:[]};let g=!1,f=!1;const p=e=>e!==f?(f=e,d.validatingChanged):[];let y=[];const m=e=>{const t=[...new Set(e)];return y.length===t.length&&t.every(e=>y.includes(e))?[]:(y=t,d.validatedChanged)};let v=[];const E=e=>{const t=[...new Set(e)];return v.length===t.length&&t.every(e=>v.includes(e))?[]:(v=t,d.touchedChanged)};let b={};const j=e=>{const t=V(e);return c(b,t)?[]:(b=t,d.errorsChanged)};let P=1500;let S=u,C=null,F=[],w=null;const O=()=>i(r=>{e({get:(e,t={},n={})=>h.get(e,x(t),U(n,r,t)),post:(e,t={},n={})=>h.post(e,x(t),U(n,r,t)),patch:(e,t={},n={})=>h.patch(e,x(t),U(n,r,t)),put:(e,t={},n={})=>h.put(e,x(t),U(n,r,t)),delete:(e,t={},n={})=>h.delete(e,x(t),U(n,r,t))}).catch(e=>t(e)||n(e)&&422===e.response?.status?null:Promise.reject(e))},P,{leading:!0,trailing:!0});let L=O();const U=(e,t,n={})=>{const i={...e,...t},s=Array.from(i.only??i.validate??v);return{...t,...r(e,t),only:s,timeout:i.timeout??5e3,onValidationError:(e,t)=>([...m([...y,...s]),...j(o(l({...b},s),e.data.errors))].forEach(e=>e()),i.onValidationError?i.onValidationError(e,t):Promise.reject(t)),onSuccess:e=>(m([...y,...s]).forEach(e=>e()),i.onSuccess?i.onSuccess(e):e),onPrecognitionSuccess:e=>([...m([...y,...s]),...j(l({...b},s))].forEach(e=>e()),i.onPrecognitionSuccess?i.onPrecognitionSuccess(e):e),onBefore:()=>{if(i.onBeforeValidation&&!1===i.onBeforeValidation({data:n,touched:v},{data:S,touched:F}))return!1;return!1!==(i.onBefore||(()=>!0))()&&(w=v,C=n,!0)},onStart:()=>{p(!0).forEach(e=>e()),(i.onStart??(()=>null))()},onFinish:()=>{p(!1).forEach(e=>e()),F=w,S=C,w=C=null,(i.onFinish??(()=>null))()}}},x=e=>!1===g?B(e):e,T={touched:()=>v,validate:(e,t,n)=>("object"!=typeof e||"target"in e||(n=e,e=t=void 0),((e,t,n)=>{if(void 0===e){const e=Array.from(n?.only??n?.validate??[]);return E([...v,...e]).forEach(e=>e()),void L(n??{})}A(t)&&!g||(e=k(e),a(S,e)!==t&&(E([e,...v]).forEach(e=>e()),L(n??{})))})(e,t,n),T),touch(e){const t=Array.isArray(e)?e:[k(e)];return E([...v,...t]).forEach(e=>e()),T},validating:()=>f,valid:()=>y.filter(e=>void 0===b[e]),errors:()=>b,hasErrors:()=>Object.keys(b).length>0,setErrors:e=>(j(e).forEach(e=>e()),T),forgetError:e=>((e=>{const t={...b};return delete t[k(e)],j(t)})(e).forEach(e=>e()),T),defaults:e=>(u=e,S=e,T),reset(...e){if(0===e.length)E([]).forEach(e=>e());else{const t=[...v];e.forEach(e=>{t.includes(e)&&t.splice(t.indexOf(e),1),s(S,e,a(u,e))}),E(t).forEach(e=>e())}return T},setTimeout:e=>((e=>{P=e,L.cancel(),L=O()})(e),T),on:(e,t)=>(d[e].push(t),T),validateFiles:()=>(g=!0,T),withoutFileValidation:()=>(g=!1,T)};return T},O=e=>Object.keys(e).reduce((t,n)=>({...t,[n]:Array.isArray(e[n])?e[n][0]:e[n]}),{}),V=e=>Object.keys(e).reduce((t,n)=>({...t,[n]:"string"==typeof e[n]?[e[n]]:e[n]}),{}),k=e=>"string"!=typeof e?e.target.name:e,B=e=>{const t={...e};return Object.keys(t).forEach(e=>{const n=t[e];null!==n&&(A(n)?delete t[e]:Array.isArray(n)?t[e]=Object.values(B({...n})):"object"!=typeof n||(t[e]=B(t[e])))}),t};export{w as c,k as r,O as t};
