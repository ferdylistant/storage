async function t(t,e=null){return new Promise((n,a)=>{if(e){if(e.split(".").reduce((t,e)=>t?t[e]:void 0,window))return n()}if(document.querySelector(`script[src="${t}"]`))return n();const i=document.createElement("script");i.src=t,i.async=!0,i.onload=n,i.onerror=()=>a(new Error(`Failed to load script: ${t}`)),document.head.appendChild(i)})}async function e(e,n){const a=document.getElementById("moments");if(!a)return;const i=window.location.pathname.split("/").filter(Boolean),l=i.length>1&&"moments"===i[0]?i[1]:null,r=function(t,e){return debounce(()=>{"function"==typeof t&&t(),"function"==typeof e&&e()},150)}(e,n),o=()=>{requestAnimationFrame(()=>setTimeout(r,80))};async function s(){try{const t=await fetch("/tab/moments",{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error("Failed to load albums");const e=await t.json();a.innerHTML=e.html,document.querySelectorAll(".album-item").forEach(t=>{t.addEventListener("click",async()=>{const e=t.getAttribute("data-album-slug");history.pushState(null,"",`/moments/${e}`),await c(e)})}),o()}catch(t){a.innerHTML='<div class="alert alert-danger text-center">Failed to load albums.</div>'}}async function c(e){try{const n=await fetch(`/tab/moments/${e}`,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!n.ok)throw new Error("Failed to load album photos");const i=await n.json(),l=(i.items??[]).filter(t=>t&&t.src&&t.srct).map(t=>({src:t.src,srct:/Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent)?t.srct:t.src,tags:t.tags??""}));if(a.innerHTML=`\n            <div class="d-flex justify-content-between align-items-center mb-3">\n                <button id="backToAlbums" class="btn btn-glass btn-sm">← Back</button>\n                <h2 style="font-family: Nickson, sans-serif;" class="text-decoration-underline mb-0">${i.album_name??"Untitled Album"}</h2>\n            </div>\n            <p class="text-center text-md-start mb-3">Click on an image to view it in a gallery.</p>\n            <div id="nanogalleryMoment"></div>\n        `,0===l.length)return void(document.getElementById("nanogalleryMoment").innerHTML=`\n    <div class="text-center py-5 px-3 glass-timeline">\n        <div class="mb-3">\n            <svg xmlns="http://www.w3.org/2000/svg" width="72" height="72" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>\n                <path d="M3 17l5-5 4 4 5-6 4 7"/>\n            </svg>\n        </div>\n        <h3 class="text-warning mb-1" style="font-family: Nickson, sans-serif; letter-spacing: 0.3rem">No photos in this album yet</h3>\n        <p class="text-white text-center mb-0">Check back later — maybe new moments ${i.album_name} will be added.</p>\n    </div>\n`);await async function(t){if(document.querySelector(`link[href*="${t.split("/").pop()}"]`))return;const e=document.createElement("link");e.rel="stylesheet",e.href=t,document.head.appendChild(e)}("https://cdn.jsdelivr.net/npm/nanogallery2/dist/css/nanogallery2.min.css"),await t("https://code.jquery.com/jquery-3.7.1.min.js","jQuery"),await t("https://cdn.jsdelivr.net/npm/nanogallery2/dist/jquery.nanogallery2.min.js","jQuery.fn.nanogallery2"),jQuery("#nanogalleryMoment").nanogallery2({items:l,galleryMosaic:[{w:2,h:2,c:1,r:1},{w:1,h:1,c:3,r:1},{w:1,h:1,c:3,r:2},{w:1,h:2,c:4,r:1},{w:2,h:1,c:5,r:1},{w:2,h:2,c:5,r:2},{w:1,h:1,c:4,r:3},{w:2,h:1,c:2,r:3},{w:1,h:2,c:1,r:3},{w:1,h:1,c:2,r:4},{w:2,h:1,c:3,r:4},{w:1,h:1,c:5,r:4},{w:1,h:1,c:6,r:4}],galleryMosaicXS:[{w:2,h:2,c:1,r:1},{w:1,h:1,c:3,r:1},{w:1,h:1,c:3,r:2},{w:1,h:2,c:1,r:3},{w:2,h:1,c:2,r:3},{w:1,h:1,c:2,r:4},{w:1,h:1,c:3,r:4}],galleryMosaicSM:[{w:2,h:2,c:1,r:1},{w:1,h:1,c:3,r:1},{w:1,h:1,c:3,r:2},{w:1,h:2,c:1,r:3},{w:2,h:1,c:2,r:3},{w:1,h:1,c:2,r:4},{w:1,h:1,c:3,r:4}],galleryMaxRows:2,gallerySorting:"random",thumbnailDisplayOrder:"random",galleryMaxItemsPerPage:20,galleryPaginationMode:"scroll",thumbnailHeight:"200",thumbnailWidth:"auto",thumbnailAlignment:"scaled",thumbnailGutterWidth:3,thumbnailGutterHeight:3,thumbnailBorderHorizontal:0,thumbnailBorderVertical:0,galleryDisplayMode:"fullContent",galleryDisplayTransitionDuration:800,thumbnailDisplayTransition:"imageSlideUp",thumbnailDisplayTransitionDuration:400,thumbnailDisplayTransitionEasing:"easeInOutQuint",thumbnailDisplayInterval:20,thumbnailBuildInit2:"image_scale_1.15",thumbnailHoverEffect2:"thumbnail_scale_1.00_1.05_300|image_scale_1.15_1.00",touchAnimation:!0,touchAutoOpenDelay:500,thumbnailLabel:{display:!0,position:"onBottomOverImage",hideIcons:!0},viewerToolbar:{display:!1},viewerTools:{topLeft:"label",topRight:"shareButton, rotateLeft, rotateRight, fullscreenButton, closeButton"},locationHash:!1}),$("#nanogalleryMoment").on("galleryDisplayed.nanogallery2",function(){o()})}catch(n){a.innerHTML='\n            <div class="d-flex justify-content-between align-items-center mb-3">\n                <button id="backToAlbums" class="btn btn-glass btn-sm">← Back</button>\n            </div>\n            <div class="alert alert-danger text-center mt-4">\n                Failed to load photos. Please try again later.\n            </div>'}}a.addEventListener("click",async t=>{("backToAlbums"===t.target.id||t.target.closest("#backToAlbums"))&&(history.pushState(null,"","/moments"),await s())}),window.onpopstate=()=>{const t=location.pathname.split("/").filter(Boolean),e="moments"===t[0]?t[1]:null;e?c(e):s()},l?c(l):s()}export{e as initGallery};
